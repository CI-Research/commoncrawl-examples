#!/bin/bash -aeu

MAIN_JAR="dist/lib/commoncrawl-examples-1.0.0.jar"
EXAMPLES_PATH="src/org/commoncrawl/examples"
EXAMPLES_PKG="org.commoncrawl.examples"

BASE_PATH=`dirname $0`"/.."
BASE_PATH=`cd ${BASE_PATH}; pwd`

if [ ! -r ~/.awssecret ]; then
  echo ""
  echo "ERROR: Please create a readable '.awssecret' file in your home directory."
  echo ""
  echo "The first line should be your AWS Access ID."
  echo ""
  echo "The second line should be your AWS Secret Key."
  echo ""
  exit 1
fi

if [ ! -e ${BASE_PATH}/${MAIN_JAR} ]; then
  echo ""
  echo "ERROR: Please run 'ant' to build '${MAIN_JAR}' before attempting to run an example."
  echo ""
  exit 1
fi

# run the example provided on the command line
if [ ! -z "$@" ]; then
  EXAMPLES="$@"
else
  EXAMPLES=$(ls ${BASE_PATH}/${EXAMPLES_PATH} | sed 's/\.java$//')
fi

# run the selected example(s)
for EXAMPLE in ${EXAMPLES}; do

  if [ ! -f ${BASE_PATH}/${EXAMPLES_PATH}/${EXAMPLE}.java ]; then
    echo ""
    echo "ERROR: Cannot run example '${EXAMPLE}' - not found."
    echo ""
    echo "Please run one of the following:"
    echo ""

    ls ${BASE_PATH}/${EXAMPLES_PATH} | sed 's/\.java$//'
    echo ""

    exit 1
  fi

  echo "* "
  echo "* Running example '${EXAMPLE}'"
  echo "* "
  echo "-------------------------------------------------------------"
  echo hadoop jar ${BASE_PATH}/${MAIN_JAR} ${EXAMPLES_PKG}.${EXAMPLE}
  echo 
  hadoop jar ${BASE_PATH}/${MAIN_JAR} ${EXAMPLES_PKG}.${EXAMPLE}

done

